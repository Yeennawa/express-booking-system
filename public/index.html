<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Booking Form</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="css/style.css" />
</head>
<script>
    // üõ°Ô∏è ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ Token ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà HTML ‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡∏Å‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤
    if (!localStorage.getItem('token')) {
        window.location.href = '/login.html';
    }
</script>

<body>
    <div id="booking" class="section">
        <div class="section-center">
            <div class="container">
                <div class="row">
                    <div class="col-md-7 col-md-push-5">
                        <div class="booking-cta">
                            <h1>Make your reservation</h1>
                            <p>‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</p>
                        </div>
                    </div>
                    <div class="col-md-4 col-md-pull-7">
                        <div class="booking-form">
                            <form id="bookingForm">
                                <div class="form-group">
                                    <span class="form-label">Your Destination</span>
                                    <input class="form-control" type="text" id="destination"
                                        placeholder="Enter a destination" required>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <span class="form-label">Check In</span>
                                            <input class="form-control" type="date" id="check_in" required>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <span class="form-label">Check out</span>
                                            <input class="form-control" type="date" id="check_out" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="form-group"><span class="form-label">Rooms</span>
                                            <select class="form-control" id="rooms">
                                                <option>1</option>
                                                <option>2</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group"><span class="form-label">Adults</span>
                                            <select class="form-control" id="adults">
                                                <option>1</option>
                                                <option>2</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group"><span class="form-label">Children</span>
                                            <select class="form-control" id="children">
                                                <option>0</option>
                                                <option>1</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-btn">
                                    <button class="submit-btn" type="submit">Check availability</button>
                                </div>
                                <div style="text-align: center; margin-top: 15px;">
                                    <a href="/login.html"
                                        style="color: #fff; font-size: 14px; text-decoration: underline;">Admin
                                        Login</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('bookingForm').onsubmit = async (e) => {
            e.preventDefault();

            // ‡∏î‡∏∂‡∏á Token ‡∏à‡∏≤‡∏Å localStorage (‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ Login ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ)
            const token = localStorage.getItem('token');

            if (!token) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á");
                window.location.href = '/login.html';
                return;
            }

            const data = {
                destination: document.getElementById('destination').value,
                check_in: document.getElementById('check_in').value,
                check_out: document.getElementById('check_out').value,
                rooms: document.getElementById('rooms').value,
                adults: document.getElementById('adults').value,
                children: document.getElementById('children').value
            };

            const res = await fetch('/api/booking', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` // ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏ï‡∏±‡πã‡∏ß‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ Server ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö
                },
                body: JSON.stringify(data)
            });

            const result = await res.json();

            if (res.status === 401 || res.status === 403) {
                alert("Session ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡πÉ‡∏´‡∏°‡πà");
                window.location.href = '/login.html';
            } else {
                alert(result.message || "Booking Successful!");
            }
        };
    </script>
</body>
</html>